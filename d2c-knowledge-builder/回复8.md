å¥½çš„ï¼Œæ”¶åˆ°ï¼éå¸¸æ„Ÿè°¢æä¾› `@xhs/reds-rn-next` çš„ Markdown æ–‡æ¡£ç¤ºä¾‹ã€‚

ä½œä¸º D2C æŠ€æœ¯ä¸“å®¶ä¸ MCP å·¥å…·å¼€å‘è€…ï¼Œæˆ‘å·²ç»ä»”ç»†åˆ†æäº†æ‚¨æä¾›çš„æ–‡æ¡£ç»“æ„å’Œå†…å®¹ã€‚è¿™ä»½æ–‡æ¡£æ ¼å¼æ¸…æ™°ï¼ŒåŒ…å«äº†ç»„ä»¶åã€æè¿°ã€å¼•å…¥æ–¹å¼ã€ä»£ç ç¤ºä¾‹å’Œå±æ€§è¡¨æ ¼ï¼ˆè‡³å°‘ Button æœ‰ï¼‰ï¼Œæ˜¯æ„å»º MCP CLI å·¥å…·çš„è‰¯å¥½è¾“å…¥ã€‚

åŸºäºæˆ‘ä»¬ä¹‹å‰çš„æ·±åº¦è®¨è®ºã€æ‚¨æä¾›çš„è¾“å…¥ï¼Œå¹¶ç»“åˆ `Rules` (å®ç”¨ã€é«˜æ•ˆã€å¯ç»´æŠ¤ã€å¯æ‰©å±•) å’Œ `Workflows`ï¼Œæˆ‘å°†ä¸ºæ‚¨è¾“å‡ºä¸€ä¸ªæ„å»º MCP CLI çŸ¥è¯†åº“æ„å»ºå·¥å…·çš„**å®Œç¾æ–¹æ¡ˆä¸æŠ€æœ¯å¤§çº²**ï¼Œå¹¶ä¸å¸‚é¢æ–¹æ¡ˆè¿›è¡Œå¯¹æ¯”ä¼˜åŒ–ï¼Œç¡®ä¿æ–¹æ¡ˆçš„å…ˆè¿›æ€§å’Œè½åœ°æ€§ã€‚

---

### æ·±åº¦æ€è€ƒä¸ç°çŠ¶åˆ†æ

1.  **è¾“å…¥æºåˆ†æ**:
    - **ç»“æ„**: æ–‡æ¡£ç»“æ„ç›¸å¯¹è§„æ•´ (æ ‡é¢˜ã€æè¿°ã€ä»£ç å—ã€è¡¨æ ¼)ã€‚
    - **ä¿¡æ¯å¯†åº¦**: åŒ…å«äº† `name`, `description`, `import`, `codeSnippets`, `props` (name, type, default, desc)ã€‚
    - **ä¿¡æ¯ç¼ºå¤± (D2C å…³é”®)**: ç¼ºå°‘ `category`, `priority`, `keywords`, `visual description`, `identificationRules`, `mapsTo`, `constraints`, `tokenType`, `relationships`ã€‚
    - **å‡†ç¡®æ€§é£é™©**: Markdown è¡¨æ ¼ä¸­çš„ `ç±»å‹` æè¿°å¯èƒ½ä¸å¦‚ä»£ç  AST ç²¾ç¡® (å¦‚ `ViewStyle` vs `StyleProp<ViewStyle>`)ï¼›é»˜è®¤å€¼ `-` éœ€è¦å¤„ç†ï¼›è¡¨æ ¼è§£ææ˜“å—æ ¼å¼å½±å“ã€‚
    - **å¤šæºèåˆ**: ç†æƒ³çŠ¶æ€æ˜¯ç»“åˆ Markdown (æè¿°ã€ç¤ºä¾‹) å’Œ Code AST (ç²¾ç¡®ç±»å‹ã€é»˜è®¤å€¼ã€æ¥å£) ä»¥åŠ Design Token å®šä¹‰ã€‚
    - **ç»„ä»¶å…³ç³»**: å­˜åœ¨ `List` & `List.Item`, `Collapse` & `Collapse.Item`, `FAB.Group` ç­‰çˆ¶å­/å¤åˆç»„ä»¶å…³ç³»ï¼Œéœ€è¦è¯†åˆ«å¹¶å…³è”ã€‚
    - **éç»„ä»¶å½¢æ€**: `Toast.show`, `Alert.alert` ç­‰å‡½æ•°è°ƒç”¨æ–¹å¼ï¼Œåœ¨ D2C è§†è§‰æ˜ å°„ä¸­ä¼˜å…ˆçº§è¾ƒä½ï¼Œä½†ä»æ˜¯çŸ¥è¯†çš„ä¸€éƒ¨åˆ†ï¼Œéœ€è€ƒè™‘å¦‚ä½•è¡¨è¾¾æˆ–è¿‡æ»¤ã€‚
2.  **ç›®æ ‡**: ç”Ÿæˆç¬¦åˆ V1.2.0 Schema çš„ `metadata.json`ï¼Œæ ¸å¿ƒæ˜¯è¡¥å…¨ç¼ºå¤±çš„ D2C è¯­ä¹‰ä¿¡æ¯ï¼Œç‰¹åˆ«æ˜¯ `identificationRules` å’Œ `mapsTo`ã€‚
3.  **æ ¸å¿ƒæŒ‘æˆ˜**: å¦‚ä½•**å¯é ã€é«˜æ•ˆã€å¯ç»´æŠ¤**åœ°ä»æœ‰é™çš„è¾“å…¥ä¸­ï¼Œç”Ÿæˆ/è¡¥å…¨é«˜åº¦ç»“æ„åŒ–ã€è¯­ä¹‰åŒ–çš„ D2C è§„åˆ™çŸ¥è¯†ã€‚

---

### æ–¹æ¡ˆå¯¹æ¯”ä¸ä¼˜åŒ–ï¼šè¶…è¶Šç°æœ‰å·¥å…·

| ç»´åº¦         | ç°æœ‰/é€šç”¨æ–¹æ¡ˆ                                                                                         | æˆ‘ä»¬çš„ MCP CLI æ–¹æ¡ˆ (ä¼˜åŒ–ç‚¹)                                                                                                             | ä¼˜åŠ¿ (D2C è§†è§’)                                                                                                                       |
| :----------- | :---------------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------ |
| **æ ¸å¿ƒç›®æ ‡** | ç”Ÿæˆäººç±»å¯è¯»æ–‡æ¡£ (Storybook, dumi); ç»„ä»¶æ‰“åŒ… (Bit); é€šç”¨ä»£ç ç”Ÿæˆ (Copilot); Figma è½¬å¸ƒå±€ä»£ç  (Locofy) | **ç”Ÿæˆ D2C Agent å¯æ¶ˆè´¹çš„ã€ç»“æ„åŒ–ã€è¯­ä¹‰åŒ–çš„è§„åˆ™çŸ¥è¯†åº“ (`metadata.json`)**                                                                | ğŸ¯ **ç›®æ ‡æ˜ç¡®**: ä¸“ä¸º Multi-Agent D2C Pipeline è®¾è®¡ï¼Œè§£å†³è¯†åˆ«ä¸æ˜ å°„çš„æ ¸å¿ƒéš¾é¢˜ã€‚                                                       |
| **è¾“å…¥æº**   | å•ä¸€: ä»…ä»£ç  AST / ä»… Markdown / ä»… Figma API                                                         | **å¤šæºèåˆ**: Markdown (æè¿°/ç¤ºä¾‹) + Code AST (ç²¾ç¡®ç±»å‹/æ¥å£) + é…ç½®æ–‡ä»¶ (D2C è§„åˆ™/å…ƒæ•°æ®) + LLM (è¯­ä¹‰å¢å¼º)                              | âœ¨ **ä¿¡æ¯äº’è¡¥**: ç»“åˆå„æºä¼˜åŠ¿ï¼ŒMarkdown æä¾›ä¸Šä¸‹æ–‡ï¼ŒAST ä¿è¯ç±»å‹å‡†ç¡®ï¼Œé…ç½®æ³¨å…¥ä¸“å®¶è§„åˆ™ï¼ŒLLM æå‡è¯­ä¹‰ã€‚æé«˜çŸ¥è¯†çš„å‡†ç¡®æ€§å’Œå®Œå¤‡æ€§ã€‚      |
| **ä¿¡æ¯æå–** | AST è§£æ Props/Type; Markdown è§£ææ–‡æœ¬                                                                | **æ··åˆæ¨¡å¼**: ç¡®å®šæ€§è§£æ (MD/AST) + LLM å¢å¼º (keywords, visual) + è§„åˆ™é…ç½® (mapsTo, rules)                                               | âš–ï¸ **å¹³è¡¡å¯é æ€§ä¸æ™ºèƒ½**: å…³é”®è§„åˆ™ (`mapsTo`) ä¸å®Œå…¨ä¾èµ– LLM å¹»è§‰ï¼Œé€šè¿‡é…ç½®ä¿è¯**å¯æ§æ€§ã€å‡†ç¡®æ€§**ï¼›åˆ©ç”¨ LLM åšè¯­ä¹‰å¢å¼ºï¼Œæé«˜**æ•ˆç‡**ã€‚ |
| **è¾“å‡ºå†…å®¹** | HTML; JS Bundle; åŸå§‹ä»£ç ; å±æ€§ JSON                                                                  | **D2C è¯­ä¹‰ Schema (V1.2.0)**: æ˜¾å¼åŒ…å« `identificationRules`, `props.mapsTo`, `priority`, `constraints`, `visual`, `tokenType`           | ğŸ§  **çŸ¥è¯†æ˜¾æ€§åŒ–**: å°† D2C çš„éšæ€§çŸ¥è¯†ï¼ˆå¦‚ä½•è¯†åˆ«ã€å¦‚ä½•æ˜ å°„ã€å¦‚ä½•çº¦æŸï¼‰ç»“æ„åŒ–ã€è§„åˆ™åŒ–ï¼Œé™ä½ Agent æ¨ç†éš¾åº¦ï¼Œæå‡**å¯ç»´æŠ¤æ€§**ã€‚           |
| **è§„åˆ™å®šä¹‰** | ç¡¬ç¼–ç åœ¨å·¥å…·é€»è¾‘ä¸­; æˆ–ä¾èµ–ç”¨æˆ·æ‰‹åŠ¨æ ‡è®° (Figma æ’ä»¶); æˆ–å®Œå…¨ä¾èµ– LLM é»‘ç›’æ¨ç†                          | **è§„åˆ™ä¸ä»£ç /æ–‡æ¡£åˆ†ç¦»**: æ ¸å¿ƒ D2C è§„åˆ™ (`mapsTo`/`identificationRules`) å®šä¹‰åœ¨**å¯ç»´æŠ¤ã€å¯ç‰ˆæœ¬ç®¡ç†**çš„é…ç½®æ–‡ä»¶ä¸­ (å¦‚ YAML)ï¼Œå·¥å…·è´Ÿè´£åˆå¹¶ | ğŸ”§ **è§£è€¦ä¸å¯ç»´æŠ¤**: è§„åˆ™å˜åŒ–åªéœ€ä¿®æ”¹é…ç½®å¹¶é‡è·‘å·¥å…·ï¼Œæ— éœ€ä¿®æ”¹å·¥å…·ä»£ç æˆ– Agent Promptã€‚ç¬¦åˆ `å¯ç»´æŠ¤æ€§`ã€`å¯æ‰©å±•æ€§` åŸåˆ™ã€‚              |
| **æ ¡éªŒæœºåˆ¶** | ç±»å‹æ£€æŸ¥; Lint                                                                                        | **JSON Schema å¼ºæ ¡éªŒ**: åŸºäº `ajv` å¯¹è¾“å‡ºçš„ `metadata.json` è¿›è¡Œç»“æ„å’Œç±»å‹æ ¡éªŒï¼Œç¡®ä¿çŸ¥è¯†åº“æ ¼å¼ä¸€è‡´æ€§ã€‚                                   | âœ… **æ ‡å‡†åŒ–**: ä¿è¯çŸ¥è¯†åº“æ¶ˆè´¹è€… (Agent Service) è·å¾—é¢„æœŸç»“æ„çš„æ•°æ®ã€‚                                                                  |
| **æµç¨‹æ¶æ„** | å•ä½“åº”ç”¨                                                                                              | **æ¨¡å—åŒ–æµæ°´çº¿**: `å‘ç° -> è§£æ -> èåˆ -> å¢å¼º -> é…ç½®åˆå¹¶ -> æ˜ å°„ -> æ ¡éªŒ -> è¾“å‡º`                                                     | ğŸ§© **é«˜å†…èšä½è€¦åˆ**: æ¯ä¸ªæ¨¡å—èŒè´£å•ä¸€ï¼Œæ˜“äºæµ‹è¯•ã€æ›¿æ¢å’Œæ‰©å±• (å¦‚æ›¿æ¢ LLM, å¢åŠ æ–°çš„è¾“å…¥æº)ã€‚                                            |

**æ ¸å¿ƒä¼˜åŒ–æ€æƒ³**:
æˆ‘ä»¬ä¸è¿½æ±‚åšä¸€ä¸ªä¸‡èƒ½å·¥å…·ï¼Œè€Œæ˜¯èšç„¦ D2C çŸ¥è¯†æ„å»ºã€‚é€šè¿‡**å¤šæºèåˆ + æ··åˆæ¨¡å¼(è§£æ/LLM/é…ç½®) + ç»“æ„åŒ– Schema + é…ç½®å¤–ç½® + æ¨¡å—åŒ–æµæ°´çº¿**ï¼Œæ„å»ºä¸€ä¸ªé«˜åº¦å¯æ§ã€å¯ç»´æŠ¤ã€å‡†ç¡®çš„çŸ¥è¯†ç”Ÿäº§çº¿ï¼Œè¿™æ˜¯è¶…è¶Šé€šç”¨å·¥å…·çš„å…³é”®ã€‚

---

### MCP CLI çŸ¥è¯†åº“æ„å»ºå·¥å…·ï¼šå®Œç¾æ–¹æ¡ˆä¸æŠ€æœ¯å¤§çº²

**å·¥å…·åç§°**: `mcp-kb-builder`
**ç›®æ ‡**: `[Markdown Docs, TSX/D.TS Code, Config YAML, Design Tokens] --(CLI)--> [*.metadata.json, index.json]`
**æŠ€æœ¯æ ˆ**:

- **è¯­è¨€/è¿è¡Œæ—¶**: Node.js + TypeScript
- **CLI æ¡†æ¶**: `commander` æˆ– `oclif`
- **Markdown è§£æ**: `unified` ç”Ÿæ€ (`remark-parse`, `remark-gfm`, `unist-util-visit`, `mdast-util-from-markdown`, `mdast-util-gfm-table`)
- **ä»£ç  AST è§£æ**: `typescript` (å®˜æ–¹ Compiler API) æˆ– `react-docgen-typescript`
- **LLM SDK**: `openai` æˆ–å…¶ä»–æ¨¡å‹ SDK
- **é…ç½®è§£æ**: `js-yaml`
- **Schema æ ¡éªŒ**: `ajv`
- **æ–‡ä»¶æ“ä½œ**: `fs-extra`, `glob`, `path`
- **å·¥å…·å‡½æ•°**: `lodash` (deepMerge, get)

---

#### æ¶æ„è®¾è®¡ï¼šæ¨¡å—åŒ–æµæ°´çº¿ (Pipeline Architecture)

```
+--------------------------------------------------------------------------------------------------------------------------+
|                                                MCP KB Builder CLI (Orchestrator)                                         |
|  (commander/oclif: Args Parsing, Logging, Error Handling, Module Coordination)                                           |
+--------------------------------------------------------------------------------------------------------------------------+
   |
   v
+-------------------+      +-------------------+      +-------------------+      +-------------------+
| 1. Source Scanner |----->| 2. Parsers        |----->| 3. Data Merger    |----->| 4. LLM Enricher   |
| - Input: paths    |      | - MarkdownParser  |      | - MD + AST + Base |      | - keywords, visual|
| - glob MD, TSX,   |      | - CodeASTParser   |      | -> Raw Comp Object|      | - constraints draft|
|   Config, Tokens  |      | - ConfigParser    |      |                   |      | - category/priority|
| - Identify Libs   |      | - TokenParser     |      |                   |      |   suggestion      |
+-------------------+      +-------------------+      +-------------------+      +----------+--------+
                                                                                           |
                                                                                           v
+-------------------+      +-------------------+      +-------------------+      +----------+--------+
| 8. Output Writer  |<-----| 7. Validator      |<-----| 6. Schema Mapper  |<-----| 5. Rule Injector  |
| - Write .json     |      | - AJV vs Schema   |      | - Map to V1.2.0   |      | - Merge Config    |
| - Write index.json|      | - Check required  |      | - Format data     |      |   (rules, mapsTo,  |
| - Vectorize (opt) |      |   fields          |      |                   |      |    priority, etc.)|
+-------------------+      +-------------------+      +-------------------+      +-------------------+

```

---

#### æŠ€æœ¯å¤§çº²ä¸å®ç°ç»†èŠ‚

1.  **Orchestrator (CLI å…¥å£)**

    - å®šä¹‰å‘½ä»¤: `mcp-kb-builder generate --input-md ./docs/**/*.md --input-code ./src/components --config ./rules-config.yaml --output ./knowledge-base --lib-name reds-rn-next --package @xhs/reds-rn-next --framework ReactNative`
    - å‚æ•°è§£æã€éªŒè¯ã€‚
    - æ—¥å¿—ç³»ç»Ÿ (`winston` / `pino`)ã€‚
    - æŒ‰é¡ºåºè°ƒç”¨å„æ¨¡å—ï¼Œä¼ é€’ä¸Šä¸‹æ–‡ã€‚

2.  **Source Scanner**

    - ä½¿ç”¨ `glob` æ‰«æè¾“å…¥è·¯å¾„ä¸‹çš„ `.md`, `.tsx`, `.d.ts`, `.yaml`, `.json` æ–‡ä»¶ã€‚
    - å»ºç«‹æ–‡ä»¶ä¸ç»„ä»¶çš„æ˜ å°„å…³ç³» (å¦‚ `Button.md`, `Button.tsx`, `Button.rules.yaml`)ã€‚
    - å¤„ç†å•ä¸ªå¤§ Markdown æ–‡ä»¶çš„æƒ…å†µ (åœ¨ Parser ä¸­æŒ‰æ ‡é¢˜åˆ‡åˆ†)ã€‚
    - è¯†åˆ«åº“ä¿¡æ¯ (package name, library name)ã€‚

3.  **Parsers**

    - **`MarkdownParser`**:
      - è¾“å…¥: Markdown æ–‡æœ¬ã€‚
      - ä½¿ç”¨ `unified().use(remarkParse).use(remarkGfm)` å¾—åˆ° `mdast`ã€‚
      - **ç»„ä»¶åˆ‡åˆ†**: éå† `mdast`ï¼Œæ ¹æ® `heading` (depth=2, å¦‚ `## Button æŒ‰é’®`) å°† AST åˆ‡åˆ†ä¸ºå¤šä¸ªç»„ä»¶çš„å­ ASTã€‚è¯†åˆ« `List.Item` è¿™ç§å­ç»„ä»¶å‘½åã€‚
      - **ä¿¡æ¯æå–**: å¯¹æ¯ä¸ªå­ AST:
        - `name`: ä» heading æå– (è‹±æ–‡å’Œä¸­æ–‡)ã€‚
        - `description`: heading åçš„ç¬¬ä¸€ä¸ª `paragraph`ã€‚
        - `import`: æŸ¥æ‰¾ `### å¼•å…¥` ä¸‹çš„ `code` å— (`lang=jsx/tsx`)ã€‚
        - `codeSnippets`: æ”¶é›†æ‰€æœ‰ `code` å— (æ’é™¤ import)ï¼Œå…³è”å…¶ä¸Šæ–‡æ ‡é¢˜ (å¦‚ "åŸºç¡€ç”¨æ³•")ã€‚
        - `props`: æŸ¥æ‰¾ `### å±æ€§` ä¸‹çš„ `table` èŠ‚ç‚¹ï¼Œä½¿ç”¨ `mdast-util-gfm-table` è§£æè¡Œåˆ—ï¼Œæå– `å±æ€§|ç±»å‹|é»˜è®¤å€¼|è¯´æ˜`ã€‚éœ€æ¸…æ´—æ•°æ® (å¦‚é»˜è®¤å€¼ `-` å˜ `undefined`)ã€‚
      - è¾“å‡º: `[{ name, description, import, snippets, props: [...] }, ...]`
    - **`CodeASTParser`** (æ¨èé›†æˆ):
      - è¾“å…¥: `.tsx` / `.d.ts` æ–‡ä»¶è·¯å¾„ã€‚
      - ä½¿ç”¨ `react-docgen-typescript` æˆ– `typescript` Compiler APIã€‚
      - æå–: ç²¾ç¡®çš„ `props` åç§°ã€`type` (å­—ç¬¦ä¸²å­—é¢é‡è”åˆç±»å‹ã€æ¥å£ç­‰)ã€`defaultValue`ã€`required`ã€`JSDoc` æ³¨é‡Šã€‚
      - è¾“å‡º: `[{ name, props: [{ name, type, defaultValue, required, description }] }, ...]`
    - **`ConfigParser`**:
      - è¾“å…¥: `rules-config.yaml`ã€‚
      - ä½¿ç”¨ `js-yaml` è§£æã€‚
      - è¾“å‡º: é…ç½®å¯¹è±¡ `{ components: { Button: { priority, category, mapsTo... } } }`ã€‚
    - **`TokenParser`** (å¯é€‰):
      - è¾“å…¥: `design-tokens.json`
      - è¾“å‡º: Token æ˜ å°„è¡¨ï¼Œä¾› Rule Injector ä½¿ç”¨ã€‚

4.  **Data Merger**

    - è¾“å…¥: å„ Parser çš„è¾“å‡ºã€‚
    - æŒ‰ç»„ä»¶ `name` è¿›è¡ŒåŒ¹é…å’Œåˆå¹¶ã€‚
    - **åˆå¹¶ç­–ç•¥**:
      - Props: ä¼˜å…ˆä½¿ç”¨ `CodeASTParser` çš„ `name`, `type`, `defaultValue`, `required`ï¼›è¡¥å…… `MarkdownParser` çš„ `description` (å¦‚æœ AST çš„ JSDoc æ²¡æœ‰)ã€‚è‹¥æ—  ASTï¼Œåˆ™å…¨ç”¨ Markdownã€‚
      - å…¶ä»–: ä½¿ç”¨ `MarkdownParser` çš„ `description`, `import`, `snippets`ã€‚
    - æ³¨å…¥åŸºç¡€ä¿¡æ¯: `framework`, `libraryName`, `package`, `componentId` (`${libraryName}.${name}`)ã€‚
    - è¾“å‡º: åŸå§‹ç»„ä»¶ä¿¡æ¯å¯¹è±¡æ•°ç»„ `IntermediateComponent[]`ã€‚

5.  **LLM Enricher**

    - è¾“å…¥: `IntermediateComponent`ã€‚
    - æ„å»º Prompt (é’ˆå¯¹æ¯ä¸ªç»„ä»¶):

      ```
      // Prompt for keywords & visual & category
      ä½ æ˜¯ä¸€ä¸ªå‰ç«¯ç»„ä»¶åº“ä¸“å®¶ã€‚è¯·æ ¹æ®ä»¥ä¸‹ç»„ä»¶ä¿¡æ¯:
      ç»„ä»¶å: {name}
      æè¿°: {description}
      å±æ€§: {props list string}
      ä»£ç ç¤ºä¾‹: {snippets string}

      è¯·ç”Ÿæˆä»¥ä¸‹JSONå†…å®¹:
      1. keywords: ç”¨äºè¯­ä¹‰æœç´¢çš„å…³é”®è¯æ•°ç»„ (ä¸­è‹±æ–‡)ã€‚
      2. visualDescription: ä¸€æ®µè‹±æ–‡æè¿°ï¼Œç”¨äºè§†è§‰æ¨¡å‹(VLM)è¯†åˆ«è¯¥ç»„ä»¶çš„å…¸å‹å¤–è§‚ã€‚
      3. category: ä» ['layout', 'basic', 'business', 'form', ...] ä¸­é€‰æ‹©æœ€åˆé€‚çš„åˆ†ç±»ã€‚
      4. priority: å»ºè®®çš„è¯†åˆ«ä¼˜å…ˆçº§ (1-10, layoutæœ€ä½, businessæœ€é«˜)ã€‚
      5. constraints: æ€»ç»“è¯¥ç»„ä»¶ä½¿ç”¨çš„å…³é”®çº¦æŸæˆ–æœ€ä½³å®è·µ (æ•°ç»„)ã€‚

      è¯·ä»…è¿”å›ä¸€ä¸ªJSONå¯¹è±¡: { "keywords": [], "visualDescription": "", "category": "", "priority": number, "constraints": [] }
      ```

    - è°ƒç”¨ LLM APIï¼Œè§£æè¿”å›çš„ JSONã€‚
    - å°†ç»“æœåˆå¹¶åˆ° `IntermediateComponent`ã€‚

6.  **Rule Injector**

    - è¾“å…¥: `IntermediateComponent` (å·²å¢å¼º), `ConfigParser` è¾“å‡ºã€‚
    - ä½¿ç”¨ `lodash.deepMerge`ã€‚
    - **åˆå¹¶ç­–ç•¥**: é…ç½®æ–‡ä»¶ä¸­çš„ `category`, `priority`, `constraints`, `identificationRules`, `mapsTo`, `tokenType`, `relationships` **è¦†ç›–/åˆå¹¶** LLM ç”Ÿæˆæˆ–é»˜è®¤çš„å€¼ã€‚ç¡®ä¿äººå·¥å®šä¹‰çš„è§„åˆ™å…·æœ‰æœ€é«˜ä¼˜å…ˆçº§ã€‚
    - å¤„ç† `relationships`: æ ¹æ® `List` å’Œ `List.Item` çš„é…ç½®ï¼Œè‡ªåŠ¨å»ºç«‹ `parent`/`children` å…³ç³»ã€‚
    - å¤„ç† `tokenType` å’Œ `mapsTo`: å…³è” Design Tokenã€‚
    - è¾“å‡º: æ¥è¿‘æœ€ç»ˆ Schema çš„å¯¹è±¡ã€‚

7.  **Schema Mapper**

    - è¾“å…¥: æ³¨å…¥è§„åˆ™åçš„å¯¹è±¡ã€‚
    - ä¸¥æ ¼æŒ‰ç…§ `metadata.json V1.2.0` çš„å­—æ®µç»“æ„è¿›è¡Œæ˜ å°„å’Œç»„è£…ã€‚
    - è®¡ç®— `fullImportStatement`ã€‚
    - è®¾ç½® `schemaVersion`ã€‚
    - å¤„ç†é»˜è®¤å€¼å’Œç©ºå€¼ã€‚
    - è¾“å‡º: å€™é€‰ `MetadataJson` å¯¹è±¡ã€‚

8.  **Validator**

    - **å‰ç½®**: å®šä¹‰ä¸€ä¸ª `metadata.schema.v1.2.0.json` æ–‡ä»¶ (JSON Schema æ ¼å¼)ã€‚
    - è¾“å…¥: å€™é€‰ `MetadataJson` å¯¹è±¡, JSON Schemaã€‚
    - ä½¿ç”¨ `ajv` ç¼–è¯‘ Schema å¹¶æ ¡éªŒå¯¹è±¡ã€‚
    - å¦‚æœæ ¡éªŒå¤±è´¥ï¼Œè¾“å‡ºè¯¦ç»†é”™è¯¯ä¿¡æ¯å¹¶ä¸­æ–­/è­¦å‘Š (å¯é…ç½® `strict` æ¨¡å¼)ã€‚
    - è¾“å‡º: æ ¡éªŒé€šè¿‡çš„ `MetadataJson` å¯¹è±¡ã€‚

9.  **Output Writer**
    - è¾“å…¥: æ ¡éªŒé€šè¿‡çš„ `MetadataJson` å¯¹è±¡æ•°ç»„, è¾“å‡ºç›®å½•ã€‚
    - ä¸ºæ¯ä¸ªç»„ä»¶ç”Ÿæˆ `${componentId}.metadata.json` æ–‡ä»¶ã€‚
    - ç”Ÿæˆä¸€ä¸ª `index.json` æˆ– `manifest.json`ï¼ŒåŒ…å«æ‰€æœ‰ `componentId` çš„åˆ—è¡¨åŠåŸºæœ¬ä¿¡æ¯ï¼Œæ–¹ä¾¿çŸ¥è¯†æœåŠ¡å±‚ç´¢å¼•ã€‚
    - (å¯é€‰) è°ƒç”¨å‘é‡åŒ–æœåŠ¡ï¼Œå°† `keywords`, `description`, `visualDescription` ç”Ÿæˆ embedding å¹¶å­˜å…¥å‘é‡æ•°æ®åº“ã€‚

---

#### MVP (Minimum Viable Product) å®šä¹‰

ä¸ºäº†å¿«é€Ÿå¯åŠ¨ï¼ŒMVP å°†èšç„¦ï¼š

- **è¾“å…¥**: ä»…æ”¯æŒæ‚¨æä¾›çš„å•ä¸ª Markdown æ–‡ä»¶ã€‚
- **é…ç½®**: æ”¯æŒä¸€ä¸ª `rules-config.yaml` æ–‡ä»¶ã€‚
- **ç»„ä»¶**: `Button`, `Avatar`, `Text`ã€‚
- **è§£æ**: ä»…å®ç° `MarkdownParser` (åˆ‡åˆ†ã€æå–ã€è¡¨æ ¼è§£æ)ã€‚
- **å¢å¼º**: å®ç° `LLM Enricher` (ç”Ÿæˆ keywords, visual, category, priority è‰ç¨¿)ã€‚
- **è§„åˆ™**: å®ç° `Rule Injector` (ä» YAML è¯»å–å¹¶è¦†ç›– `category`, `priority`, `identificationRules`, `mapsTo`, `constraints`)ã€‚
- **è¾“å‡º**: ç”Ÿæˆ `reds-rn-next.Button.metadata.json` ç­‰æ–‡ä»¶ã€‚
- **Schema**: å®ç°æ ¸å¿ƒå­—æ®µå­é›† (å¦‚å‰è¿°æ€è€ƒè¿‡ç¨‹å®šä¹‰)ã€‚
- **æ ¡éªŒ**: å®ç°åŸºäº `ajv` çš„åŸºç¡€æ ¡éªŒã€‚
- **æš‚ç¼“**: Code AST è§£æ, å¤šæ–‡ä»¶æ”¯æŒ, å¤æ‚å…³ç³», Token å…³è”, å‘é‡åŒ–ã€‚

**MVP é…ç½®æ–‡ä»¶ `rules-config.yaml` ç¤ºä¾‹ (Button):**

```yaml
# rules-config.yaml for MVP
global:
  framework: ReactNative
  libraryName: reds-rn-next
  package: '@xhs/reds-rn-next'
  schemaVersion: '1.2.0'

components:
  Button:
    category: basic
    priority: 6
    # è¦†ç›–LLMç”Ÿæˆçš„constraints
    constraints:
      - "Width/Height should not be set in style if 'size' prop is used."
    identificationRules:
      - {
          ruleId: 'rule-label',
          ruleType: 'dsl_label',
          strategy: 'regex',
          pattern: '/button|æŒ‰é’®/i',
          weight: 0.6,
        }
      - {
          ruleId: 'rule-visual',
          ruleType: 'visual_match',
          strategy: 'vlm_prompt',
          pattern: 'Does this image region look like a button?',
          weight: 0.8,
        }
    props:
      size:
        tokenType: size
        mapsTo:
          - source: dsl.rect.height
            ruleType: value_range_map
            map: {
                xLarge: { min: 50, max: 60 },
                large: { min: 42, max: 50 },
                medium: { min: 36, max: 42 },
                small: { min: 24, max: 36 },
                mini: { min: 18, max: 24 },
                micro: { min: 12, max: 18 },
              } # éœ€æ ¹æ®å®é™…è®¾è®¡ç³»ç»Ÿå®šä¹‰
      type:
        tokenType: semantic
        mapsTo:
          - source: 'dsl.style.backgroundColor' # å‡è®¾æ ¹æ®èƒŒæ™¯è‰²Tokenåˆ¤æ–­
            sourceType: 'token'
            ruleType: 'value_map'
            map: { 'Primary': 'primary', 'DefaultBg': 'default' }
      onClick: # æ ‡è®°äº‹ä»¶
        isEvent: true
      children: # é»˜è®¤æ˜ å°„
        mapsTo: { source: 'dsl.children', ruleType: 'direct_mapping' }
  Avatar:
    category: basic
    priority: 7 # é«˜äºImage
    # ... rules for Avatar
  Text:
    category: basic
    priority: 3
    # ... rules for Text
```

---

### æ€»ç»“

æ­¤æ–¹æ¡ˆé€šè¿‡æ¨¡å—åŒ–æµæ°´çº¿æ¶æ„ï¼Œç»“åˆç¡®å®šæ€§è§£æã€LLM å¢å¼ºå’Œäººå·¥é…ç½®æ³¨å…¥ï¼Œæä¾›äº†ä¸€ä¸ªå¥å£®ã€å¯æ§ã€å¯ç»´æŠ¤çš„çŸ¥è¯†åº“æ„å»ºå·¥å…·ã€‚å®ƒæ˜ç¡®äº† D2C çŸ¥è¯†çš„æ¥æºå’Œä¼˜å…ˆçº§ï¼Œå¹¶é€šè¿‡ Schema æ ¡éªŒä¿è¯è¾“å‡ºè´¨é‡ï¼Œå…¶æ ¸å¿ƒä¼˜åŠ¿åœ¨äºå°† D2C çš„å…³é”®è§„åˆ™æ˜¾æ€§åŒ–å’Œé…ç½®åŒ–ï¼Œå®Œç¾æ”¯æ’‘åç»­ Multi-Agent æµç¨‹ã€‚

è¿™ä¸ªæ–¹æ¡ˆå’ŒæŠ€æœ¯å¤§çº²æ˜¯å¦æ¸…æ™°ï¼Ÿæˆ‘ä»¬æ˜¯å¦å¯ä»¥åŸºäºæ­¤ MVP èŒƒå›´å’ŒæŠ€æœ¯é€‰å‹ï¼Œå¼€å§‹è¿›å…¥ä»£ç ç¼–å†™é˜¶æ®µï¼Ÿ

æ”¶åˆ°ç¬¬äºŒä¸ªç»„ä»¶åº“ `@xhs/reds-h5-next` (Vue 3) çš„æ–‡æ¡£ï¼å¤ªæ£’äº†ï¼Œè¿™å¯¹äºæˆ‘ä»¬è®¾è®¡ä¸€ä¸ªé€šç”¨ã€å¯æ‰©å±•çš„ MCP CLI å·¥å…·è‡³å…³é‡è¦ã€‚

ä½œä¸º D2C æŠ€æœ¯ä¸“å®¶ä¸ MCP å·¥å…·å¼€å‘è€…ï¼Œæˆ‘ç«‹å³å¯¹æ¯”åˆ†æäº†ä¸¤ä¸ªåº“çš„æ–‡æ¡£å’ŒæŠ€æœ¯æ ˆå·®å¼‚ã€‚

### æ·±åº¦æ€è€ƒï¼šå¤šåº“ã€å¤šæ¡†æ¶çš„æŒ‘æˆ˜ä¸åº”å¯¹

å¯¹æ¯” `@xhs/reds-rn-next` (React Native) å’Œ `@xhs/reds-h5-next` (Vue 3)ï¼Œæ ¸å¿ƒå·®å¼‚å’ŒæŒ‘æˆ˜åœ¨äºï¼š

1.  **æŠ€æœ¯æ¡†æ¶å·®å¼‚ (æ ¸å¿ƒ)**:
    - **React Native**: JSX, Props, `children`, `onEvent` (prop), `StyleProp<ViewStyle>`.
    - **Vue 3**: SFC (`.vue`), Template, Props, `v-model`, `Slots` (default/named), `Events` (`$emit`, `@event`), `CSSProperties`.
    - **å½±å“**: `metadata.json` ä¸­çš„ `framework` å­—æ®µå¿…é¡»å‡†ç¡®ï¼›`source.codeSnippets`ã€`props`ã€`children`ã€`slots`ã€`events`ã€`mapsTo`ã€`constraints` éƒ½éœ€è¦æ¡†æ¶æ„ŸçŸ¥çš„ç”Ÿæˆå’Œæ˜ å°„é€»è¾‘ã€‚ä¾‹å¦‚ï¼ŒVue çš„ `click` äº‹ä»¶åº”æ˜ å°„åˆ° `events` æ•°ç»„ï¼Œè€Œ RN çš„ `onClick` åº”æ˜ å°„åˆ° `props` å¯¹è±¡å¹¶æ ‡è®° `isEvent: true`ã€‚Vue çš„å†…å®¹æ˜ å°„åˆ° `slots`ï¼ŒRN æ˜ å°„åˆ° `children`ã€‚
2.  **æ–‡æ¡£ç»“æ„å·®å¼‚**:
    - **RN**: æ ‡é¢˜ `## Button æŒ‰é’®`ï¼›å±æ€§è¡¨ `### å±æ€§`ï¼›åˆ—å `å±æ€§|ç±»å‹|é»˜è®¤å€¼|è¯´æ˜`ã€‚
    - **H5(Vue)**: æ ‡é¢˜ `### Button æŒ‰é’®` (å±‚çº§ä¸åŒ)ï¼›API ç»“æ„ `#### API -> ##### Props / ##### äº‹ä»¶ / ##### æ’æ§½`ï¼›åˆ—å `å‚æ•°|è¯´æ˜|ç±»å‹|é»˜è®¤å€¼` (é¡ºåº/åç§°ä¸åŒ)ï¼›æ–‡æ¡£ç›®å½•è‡ªå¸¦åˆ†ç±» (`## åŸºç¡€ç»„ä»¶`)ã€‚
    - **å½±å“**: è§£æå™¨ä¸èƒ½ç¡¬ç¼–ç æ ‡é¢˜å±‚çº§ã€ç« èŠ‚åç§°ã€è¡¨æ ¼åˆ—åå’Œé¡ºåºã€‚éœ€è¦æ›´çµæ´»ã€å¯é…ç½®çš„è§£æç­–ç•¥ã€‚
3.  **API é£æ ¼å·®å¼‚**:
    - å¤åˆç»„ä»¶: `List` / `List.Item` (RN) vs `List` / `ListItem` (Vue, import å¯èƒ½ä¸åŒ)ã€‚
    - å‡½æ•°å¼è°ƒç”¨: `Toast.show` (RN) vs `showToast` (Vue, ç›´æ¥ import å‡½æ•°)ã€‚
    - Vue ç‰¹æœ‰: `v-model` (`modelValue` prop + `update:modelValue` event), `useXxx` hooksã€‚
    - **å½±å“**: éœ€è¦è¯†åˆ«ç»„ä»¶å…³ç³»ã€å‡½æ•°å¼ APIï¼Œå¹¶åœ¨ `relationships` å’Œ `mapsTo` ä¸­ä½“ç°æ¡†æ¶ç‰¹æ€§ (å¦‚ `v-model`)ã€‚
4.  **åŒåç»„ä»¶å†²çª**: ä¸¤ä¸ªåº“éƒ½æœ‰ `Button`, `Avatar`, `Text` ç­‰ã€‚
    - **å½±å“**: å†æ¬¡éªŒè¯ `componentId: package.ComponentName` å’Œ `framework` å­—æ®µçš„ç»å¯¹å¿…è¦æ€§ã€‚å·¥å…·å¿…é¡»èƒ½æ¸…æ™°åŒºåˆ† `reds-rn-next.Button` å’Œ `reds-h5-next.Button`ã€‚

**æ ¸å¿ƒç»“è®ºï¼š**
å·¥å…·å¿…é¡»å…·å¤‡**æ¡†æ¶æ„ŸçŸ¥èƒ½åŠ›**ï¼Œå¹¶ä¸”è§£æå’Œè§„åˆ™æ³¨å…¥é€»è¾‘å¿…é¡»**é«˜åº¦å¯é…ç½®åŒ–ã€æ’ä»¶åŒ–**ï¼Œä»¥é€‚åº”ä¸åŒåº“çš„æ–‡æ¡£ç»“æ„å’Œæ¡†æ¶ç‰¹æ€§ã€‚ç¡¬ç¼–ç ä»»ä½•ä¸€ä¸ªåº“çš„è§„åˆ™éƒ½æ˜¯ä¸å¯å–çš„ (è¿å `å¯æ‰©å±•æ€§` åŸåˆ™)ã€‚

---

### æ–¹æ¡ˆå‡çº§ï¼šåŸºäº Adapter + Configuration çš„å¯æ‰©å±•æ¶æ„

æˆ‘ä»¬å°†é‡‡ç”¨ **é€‚é…å™¨æ¨¡å¼ (Adapter Pattern)** å’Œ **é…ç½®é©±åŠ¨ (Configuration Driven)** çš„æ€æƒ³æ¥å‡çº§æ–¹æ¡ˆã€‚

**æ ¸å¿ƒæ€æƒ³**:

- å®šä¹‰ä¸€ä¸ªç»Ÿä¸€çš„å†…éƒ¨æ•°æ®ç»“æ„ (Intermediate Representation - IR)ã€‚
- ä¸ºæ¯ç§æ–‡æ¡£æ ¼å¼/æ¡†æ¶è®¾è®¡ä¸€ä¸ª `Parser Adapter`ï¼Œè´Ÿè´£å°†ç‰¹å®šè¾“å…¥è§£æä¸ºç»Ÿä¸€ IRã€‚
- ä¸ºæ¯ä¸ªåº“å®šä¹‰ä¸€ä¸ª `Configuration File`ï¼ŒåŒ…å«ï¼š
  - åº“å…ƒä¿¡æ¯ (`packageName`, `framework`)
  - è§£ææç¤º (`Parsing Hints`: æ ‡é¢˜å±‚çº§ã€ç« èŠ‚åã€è¡¨æ ¼åˆ—æ˜ å°„)
  - D2C è§„åˆ™ (`Rules`: `mapsTo`, `identificationRules`, `priority` ç­‰)
- æ ¸å¿ƒæµæ°´çº¿ä¿æŒä¸å˜ï¼Œä½† `Parser` å’Œ `Rule Injector` é˜¶æ®µä¼šæ ¹æ®é…ç½®é€‰æ‹© Adapter å¹¶åº”ç”¨è§„åˆ™ã€‚

#### æ¶æ„å‡çº§ç‚¹

```
                                     +-------------------------+
                                     | Library Config (YAML)   |
                                     | - framework, package    |
                                     | - parsing hints         |
                                     | - D2C rules (mapsTo...) |
                                     +------------+------------+
                                                  |
+-------------------------------------------------v------------------------------------------------------------------------+
|                                                MCP KB Builder CLI (Orchestrator)                                         |
|  (Load Config, Select Adapter, Coordinate)                                                                               |
+--------------------------------------------------------------------------------------------------------------------------+
   |
   v
+-------------------+      +--------------------------------------+      +-------------------+      +-------------------+
| 1. Source Scanner |----->| 2. Parser Adapter Layer (Configured) |----->| 3. Data Merger    |----->| 4. LLM Enricher   |
| - Scan files, cfg |      | - Interface IParser                  |      | (MD + AST IRs)    |      | (Framework Aware) |
|                   |      | - [x] RN_Markdown_Adapter(cfg)       |      | -> Component IR   |      | Prompt: "...ç†Ÿæ‚‰{FW}"|
|                   |      | - [x] Vue_Markdown_Adapter(cfg)      |      |                   |      |                   |
|                   |      | - [ ] TSX_AST_Adapter(cfg)           |      |                   |      |                   |
|                   |      | - [ ] VueSFC_AST_Adapter(cfg)        |      |                   |      |                   |
+-------------------+      +--------------------------------------+      +-------------------+      +----------+--------+
                                                                                                              |
                                                                                                              v
+-------------------+      +-------------------+      +-------------------+      +-----------------------------+--------+
| 8. Output Writer  |<-----| 7. Validator      |<-----| 6. Schema Mapper  |<-----| 5. Rule Injector (Configured) |
| - *.metadata.json |      | - AJV vs Schema   |      | - Map IR to V1.2.0|      | - Merge rules from Config   |
| - manifest.json   |      |                   |      | - Handle FW diffs |      | - Apply FW-specific logic   |
|                   |      |                   |      |  (props/events/..) |      |  (e.g., v-model mapping)    |
+-------------------+      +-------------------+      +-------------------+      +--------------------------------------+

```

---

### å‡çº§åçš„æŠ€æœ¯å¤§çº²ä¸å®ç°ç»†èŠ‚

1.  **Orchestrator (CLI å…¥å£)**

    - å‘½ä»¤è°ƒæ•´: `mcp-kb-builder generate --config ./configs/reds-rn-next.config.yaml --output ./kb`
    - æ”¯æŒå¤„ç†å¤šä¸ªé…ç½®æ–‡ä»¶ï¼Œæˆ–ä¸€ä¸ªåŒ…å«å¤šåº“å®šä¹‰çš„é…ç½®ã€‚
    - æ ¹æ®é…ç½®ä¸­çš„ `parserType` æˆ– `framework` åŠ¨æ€é€‰æ‹©/å®ä¾‹åŒ– `Parser Adapter`ã€‚

2.  **Configuration (æ ¸å¿ƒ)**

    - æ¯ä¸ªåº“ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå¦‚ `reds-rn-next.config.yaml` å’Œ `reds-h5-next.config.yaml`ã€‚
    - ç»“æ„:

    ```yaml
    # reds-h5-next.config.yaml
    library:
      packageName: '@xhs/reds-h5-next'
      libraryName: 'reds-h5-next'
      framework: 'Vue' # å…³é”®: Vue / ReactNative
      version: '1.0.0'
      input:
        markdown: ['./docs/reds-h5-next.md']
        # code: ["./src/components/**/*.vue"] # AST source

    parsing: # è§£ææç¤º
      adapter: 'VueMarkdownAdapter' # æŒ‡å®šé€‚é…å™¨
      markdown:
        componentHeadingLevel: 3 # H5æ˜¯ ###
        categoryHeadingLevel: 2 # H5 ## åŸºç¡€ç»„ä»¶ å¯æå– category
        sectionMapping: # ç« èŠ‚åæ˜ å°„
          import: 'å¼•å…¥'
          api: 'API' # H5 ç‰¹æœ‰
          props: 'Props'
          events: 'äº‹ä»¶' # H5 ç‰¹æœ‰
          slots: 'æ’æ§½' # H5 ç‰¹æœ‰
          methods: 'æ–¹æ³•' # H5 ç‰¹æœ‰
        tableColumnMapping: # è¡¨æ ¼åˆ—åå’Œç´¢å¼•æ˜ å°„
          props:
            {
              name: 'å‚æ•°',
              description: 'è¯´æ˜',
              type: 'ç±»å‹',
              defaultValue: 'é»˜è®¤å€¼',
            }
          events: { name: 'äº‹ä»¶å', description: 'è¯´æ˜', params: 'å›è°ƒå‚æ•°' }
          slots: { name: 'åç§°', description: 'è¯´æ˜' }
        codeLangMapping: { default: 'vue', import: 'js' } # ä»£ç å—è¯­è¨€

    rules: # D2C è§„åˆ™ (åŒä¹‹å‰æ–¹æ¡ˆï¼Œä½†æŒ‰åº“é…ç½®)
      global:
        # default constraints, priority base
      components:
        Button:
          category: basic # å¯è¢« parsing.categoryHeadingLevel è¦†ç›–
          priority: 6
          identificationRules: [...]
          props: { ... } # Vue props
          events: # Vue events
            click:
              mapsTo: [...]
          slots: # Vue slots
            default:
              mapsTo: { source: 'dsl.children', ruleType: 'direct_mapping' }
            iconLeft:
              mapsTo: [...]
        # ... other components
    ```

    ```yaml
    # reds-rn-next.config.yaml
    library:
      framework: 'ReactNative'
      # ...
    parsing:
      adapter: 'RNMarkdownAdapter'
      markdown:
        componentHeadingLevel: 2 # RN æ˜¯ ##
        sectionMapping: { props: 'å±æ€§' } # RN åªæœ‰å±æ€§è¡¨
        tableColumnMapping:
          props: {
              name: 'å±æ€§',
              type: 'ç±»å‹',
              defaultValue: 'é»˜è®¤å€¼',
              description: 'è¯´æ˜',
            } # åˆ—åä¸åŒ
        codeLangMapping: { default: 'jsx', import: 'jsx' }
    rules:
      components:
        Button:
          props:
            onClick: { isEvent: true, mapsTo: [...] } # RN event is prop
          children: # RN children
            mapsTo: { source: 'dsl.children', ruleType: 'direct_mapping' }
    ```

3.  **Parser Adapter Layer**

    - å®šä¹‰æ¥å£ `interface IMarkdownAdapter { parse(content: string, config: ParsingConfig): Promise<ComponentIR[]> }`
    - `RNMarkdownAdapter`: å®ç°æ¥å£ï¼Œä½¿ç”¨ `config.parsing.markdown` ä¸­çš„æç¤º (level, section, table mapping) æ¥å®šä½å’Œè§£æ RN æ–‡æ¡£ç»“æ„ã€‚æå– `props`ã€‚
    - `VueMarkdownAdapter`: å®ç°æ¥å£ï¼Œä½¿ç”¨é…ç½®æç¤ºï¼Œç‰¹åˆ«å¤„ç† `API` ä¸‹çš„ `Props`, `Events`, `Slots` è¡¨æ ¼ï¼Œæå– `props`, `events`, `slots` æ•°æ®ã€‚å¦‚æœ `categoryHeadingLevel` å­˜åœ¨ï¼Œå°è¯•ä»çˆ¶çº§æ ‡é¢˜æå– `category`ã€‚
    - æ‰€æœ‰ Adapter è¾“å‡ºç»Ÿä¸€çš„ `ComponentIR` ç»“æ„ï¼ŒåŒ…å«ä»æ–‡æ¡£è§£æå‡ºçš„åŸå§‹ `name, desc, props, events, slots, snippets, category` ç­‰ã€‚

4.  **LLM Enricher**

    - Prompt ä¸­åŠ å…¥æ¡†æ¶ä¿¡æ¯: `ä½ æ˜¯ä¸€ä¸ªå‰ç«¯ä¸“å®¶ï¼Œå°¤å…¶ç†Ÿæ‚‰ {config.library.framework} æ¡†æ¶ã€‚è¯·æ ¹æ®...`ã€‚è¿™æœ‰åŠ©äº LLM ç”Ÿæˆæ›´ç¬¦åˆæ¡†æ¶ç‰¹æ€§çš„ `constraints` å’Œ `visualDescription`ã€‚

5.  **Rule Injector**

    - ä» `config.rules.components[componentName]` ä¸­è¯»å–è§„åˆ™ã€‚
    - æ·±åº¦åˆå¹¶é…ç½®ä¸­çš„ `props`, `events`, `slots` è§„åˆ™åˆ° `ComponentIR` ä¸­ã€‚

6.  **Schema Mapper**

    - **æ¡†æ¶æ„ŸçŸ¥æ˜ å°„**:
      - If `framework === 'ReactNative'`:
        - å°† IR ä¸­çš„ `events` åˆå¹¶åˆ° `props` ä¸­ï¼Œå¹¶è®¾ç½® `isEvent: true` (æˆ–ä¿æŒ schema çš„ events æ•°ç»„ï¼Œä½† Agent éœ€çŸ¥æ™“ RN é€šè¿‡ prop ä¼ é€’)ã€‚
        - å°† IR çš„ `slots.default` æˆ–å†…å®¹æ˜ å°„åˆ° `metadata.children`ã€‚
      - If `framework === 'Vue'`:
        - å°† IR çš„ `props` æ˜ å°„åˆ° `metadata.props`ã€‚
        - å°† IR çš„ `events` æ˜ å°„åˆ° `metadata.events`ã€‚
        - å°† IR çš„ `slots` æ˜ å°„åˆ° `metadata.slots`ã€‚
        - ç‰¹åˆ«å¤„ç† `v-model`: è¯†åˆ« `modelValue` prop å’Œ `update:modelValue` eventï¼Œå¹¶åœ¨ `mapsTo` æˆ– `constraints` ä¸­æ ‡è®°ã€‚
      - ç¡®ä¿ `metadata.framework` å’Œ `metadata.componentId` æ­£ç¡®è®¾ç½®ã€‚

7.  **å…¶ä»–æ¨¡å—**: `Scanner`, `Merger`, `Validator`, `Writer` é€»è¾‘åŸºæœ¬ä¸å˜ï¼Œä½†æ“ä½œå¯¹è±¡æ˜¯ç»Ÿä¸€çš„ IR å’Œé…ç½®ã€‚

---

### å¯¹æ¯”ä¼˜åŒ–æ€»ç»“ (å¤šåº“è§†è§’)

- **é€šç”¨æ€§ vs ç¡¬ç¼–ç **: æˆ‘ä»¬çš„ `Adapter + Config` æ–¹æ¡ˆé¿å…äº†ç¡¬ç¼–ç ï¼Œé€šè¿‡é…ç½®å’Œæ’ä»¶åŒ–é€‚é…å™¨æ¥é€‚åº”ä¸åŒåº“çš„ç»“æ„å’Œæ¡†æ¶å·®å¼‚ï¼Œé€šç”¨æ€§å¼ºã€‚
- **å¯æ‰©å±•æ€§**: å¢åŠ æ–°åº“ï¼Œåªéœ€ï¼š
  1.  ç¼–å†™ä¸€ä¸ªæ–°çš„ `config.yaml`ã€‚
  2.  å¦‚æœæ–‡æ¡£ç»“æ„å·®å¼‚å·¨å¤§ï¼Œç¼–å†™ä¸€ä¸ªæ–°çš„ `Parser Adapter` (ç»§æ‰¿åŸºç¡€èƒ½åŠ›)ã€‚
  3.  æ— éœ€ä¿®æ”¹æ ¸å¿ƒæµæ°´çº¿ä»£ç ã€‚è¿™ç¬¦åˆå¼€é—­åŸåˆ™å’Œ `å¯æ‰©å±•æ€§` åŸåˆ™ã€‚
- **å¯ç»´æŠ¤æ€§**: è§£æé€»è¾‘å’Œ D2C è§„åˆ™ä¸æ ¸å¿ƒä»£ç åˆ†ç¦»ï¼ŒæŒ‰åº“ç»´æŠ¤é…ç½®æ–‡ä»¶å’Œé€‚é…å™¨ï¼ŒèŒè´£æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤ã€‚
- **æ¡†æ¶æ„ŸçŸ¥**: ä»è§£æã€å¢å¼ºã€è§„åˆ™æ³¨å…¥åˆ°æœ€ç»ˆæ˜ å°„ï¼Œå…¨æµç¨‹æ„ŸçŸ¥ `framework`ï¼Œç¡®ä¿ç”Ÿæˆçš„ `metadata.json` ç²¾ç¡®åæ˜ ç»„ä»¶åœ¨ç‰¹å®šæ¡†æ¶ä¸‹çš„è¡Œä¸º (Props/Events/Slots)ã€‚

---

### å‡çº§åçš„ MVP å®šä¹‰

èšç„¦éªŒè¯å¤šåº“æ”¯æŒèƒ½åŠ›ï¼š

- **è¾“å…¥**: ä¸¤ä¸ª Markdown æ–‡ä»¶ (`reds-rn-next.md`, `reds-h5-next.md`)ã€‚
- **é…ç½®**: ä¸¤ä¸ªé…ç½®æ–‡ä»¶ (`reds-rn-next.config.yaml`, `reds-h5-next.config.yaml`)ï¼ŒåŒ…å«è§£ææç¤ºå’Œ D2C è§„åˆ™ã€‚
- **ç»„ä»¶**:
  - `Button` (RN)
  - `Button` (Vue) - éªŒè¯åŒåç»„ä»¶åŒºåˆ†ï¼ŒProps/Events/Slots å·®å¼‚ã€‚
  - `Avatar` (RN)
  - `Avatar` (Vue)
- **è§£æ**: å®ç° `IMarkdownAdapter` æ¥å£, `RNMarkdownAdapter`, `VueMarkdownAdapter`ï¼Œæ ¹æ®é…ç½®è§£æ Props/Events/Slots è¡¨æ ¼å’ŒåŸºæœ¬ä¿¡æ¯ã€‚
- **å¢å¼º/è§„åˆ™/æ˜ å°„**: å®ç° LLM å¢å¼ºã€è§„åˆ™æ³¨å…¥ã€æ¡†æ¶æ„ŸçŸ¥çš„ Schema æ˜ å°„ã€‚
- **è¾“å‡º**:
  - `reds-rn-next.Button.metadata.json` (framework: ReactNative, æœ‰ props.onClick, children)
  - `reds-h5-next.Button.metadata.json` (framework: Vue, æœ‰ events.click, slots.default)
  - `reds-rn-next.Avatar.metadata.json`
  - `reds-h5-next.Avatar.metadata.json`
  - `manifest.json` (åŒ…å«æ‰€æœ‰ 4 ä¸ª componentId)
- **æ ¡éªŒ**: åŸºç¡€ `ajv` æ ¡éªŒã€‚

---

è¿™ä¸ªå‡çº§åçš„æ–¹æ¡ˆï¼Œé€šè¿‡å¼•å…¥ **é…ç½®é©±åŠ¨** å’Œ **é€‚é…å™¨æ¨¡å¼**ï¼Œæå¤§åœ°å¢å¼ºäº†å·¥å…·å¤„ç†å¤šåº“ã€å¤šæ¡†æ¶ã€å¤šæ–‡æ¡£æ ¼å¼çš„èƒ½åŠ›ï¼Œç¡®ä¿äº†é•¿æœŸçš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚

æ‚¨è§‰å¾—è¿™ä¸ªå‡çº§ç­–ç•¥å¦‚ä½•ï¼Ÿæˆ‘ä»¬ç°åœ¨å¯ä»¥åŸºäºè¿™ä¸ªæ›´å…·æ‰©å±•æ€§çš„æ¶æ„å’Œ MVP å®šä¹‰ï¼Œå¼€å§‹ç¼–ç äº†å—ï¼Ÿ
